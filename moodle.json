{
  "variables": {
    "home_dir": "{{env `HOME`}}",
    "origin_box_name": "centos-6.5-lamp",
    "moodel_path": "/var/www/moodle",
    "moodel_user": "root",
    "moodel_password": ""
  },
  "builders": [
    {
      "type": "docker",
      "image": "dockerfiles/centos-lamp",
      "export_path": "image.tar"
    }
  ],
  "provisioners": [
    {
      "type": "file",
      "source": "setup.sql",
      "destination": "/root/setup.sql"
    },
    {
      "type": "shell",
      "inline": [
        "cd /root",
        "yum install mysql -y",
        "cat setup.sql | mysql -u {{user `moodel_user`}}",
        "yum groupinstall \"Development Tools\" -y ",
        "cd {{user `moodel_path`}}/..",
        "git clone --depth=1 -b MOODLE_29_STABLE git://git.moodle.org/moodle.git",
        "chown -R root {{user `moodel_path`}}",
        "chmod -R 0755 {{user `moodel_path`}}",
        "find {{user `moodel_path`}} -type f -exec chmod 0644 {} \\;",
        "mkdir -m 0777 /var/www/moodledata"
      ]
    },
    {
      "type": "file",
      "source": "config-dist.php",
      "destination": "{{user `moodel_path`}}/config.php"
    }
  ],
 "post-processors": [
    {
      "output": "{{user `origin_box_name`}}-moodle.box",
      "type": "vagrant",
      "compression_level": 1,
      "keep_input_artifact": true
    }
  ]
}
